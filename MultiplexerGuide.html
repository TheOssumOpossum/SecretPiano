<p>Running out of analog inputs on your arduino? Use a multiplexer!</p>
<p><strong>What is a multiplexer?</strong></p>
<p><strong><img src="https://media.digikey.com/Photos/Sparkfun%20Elec%20%20Photos/BOB-09056_sml.jpg" width="200" height="200" /></strong></p>
<p>The <a href="https://www.digikey.com/product-detail/en/sparkfun-electronics/BOB-09056/1568-1181-ND/5673767?WT.srch=1&amp;gclid=CjwKCAjwxZnYBRAVEiwANMTRX2wJyQunLQfYo7_3dLnVOTQ0Wl2Fj86ZC7I7i_l4zFiFO1tiINX22BoCgQQQAvD_BwE">CD74HC4067 Multiplexer</a> is essentially a switch that lets you alternate between reading 1 of 16 inputs very quickly.</p>
<p><strong>How do I use the CD74HC4067?</strong></p>
<p>While <a href="http://bildr.org/2011/02/cd74hc4067-arduino/">this blog post&nbsp;</a>and <a href="https://www.sparkfun.com/datasheets/IC/cd74hc4067.pdf">this datasheet</a> might explain everything you need to know in detail, I've been commissioned to write a guide on how I used my multiplexer.</p>
<p><strong>Wiring</strong></p>
<p>This picture has pretty much everything you need to know. Your 16 inputs go into slots C0-C15. EN &amp; GND go to ground, VCC goes to 5V, S0-S3 go into the digital slots 8-11* and SIG goes to Analog Input 0*</p>
<p><em>*(if you choose other ports you will have to modify the code)</em></p>
<p><img src="http://bildr.org/blog/wp-content/uploads/2011/01/CD74HC4067_Empty.png" width="1087" height="506" /></p>
<p><strong>Coding</strong></p>
<p>If you wired everything well, this code should alternate between reading each input and print the received input into the 9600 baud. If you are getting noisy inputs, your mux wiring or sensor wiring are probably wrong. You can test your sensor wiring by skipping the mux and going straight to one of the other analog pins.</p>
<pre style="padding-left: 30px;">//Mux control pins*<br />int s0 = 8;<br />int s1 = 9;<br />int s2 = 10;<br />int s3 = 11;<br /><br />//Mux in &ldquo;SIG&rdquo; pin*<br />int SIG_pin = 0;<br /><br />int readMux(int channel) {<br />int controlPin[] = {s0,s1,s2,s3};<br />int muxChannel[16][4] = {<br />{0,0,0,0}, //channel 0<br />{1,0,0,0}, //channel 1<br />{0,1,0,0}, //channel 2<br />{1,1,0,0}, //channel 3<br />{0,0,1,0}, //channel 4<br />{1,0,1,0}, //channel 5<br />{0,1,1,0}, //channel 6<br />{1,1,1,0}, //channel 7<br />{0,0,0,1}, //channel 8<br />{1,0,0,1}, //channel 9<br />{0,1,0,1}, //channel 10<br />{1,1,0,1}, //channel 11<br />{0,0,1,1}, //channel 12<br />{1,0,1,1}, //channel 13<br />{0,1,1,1}, //channel 14<br />{1,1,1,1} //channel 15<br />};<br />//loop through the 4 sig <br />for (int i = 0; i &lt; 4; i++) {<br />digitalWrite(controlPin[i], muxChannel[channel][i]);<br />}<br />//read the value at the SIG pin <br />int val = analogRead(SIG_pin);<br />//return the value <br />return val;<br />}<br /><br />//switch mux to channel 15 and read the value<br />int val = readMux(15);<br /><br /><br />void setup() {<br />pinMode(s0, OUTPUT);<br />pinMode(s1, OUTPUT);<br />pinMode(s2, OUTPUT);<br />pinMode(s3, OUTPUT);<br /><br />digitalWrite(s0, LOW);<br />digitalWrite(s1, LOW);<br />digitalWrite(s2, LOW);<br />digitalWrite(s3, LOW);<br /><br />Serial.begin(9600);<br />}<br /><br />void loop() {<br /><br />//Loop through and read all 16 values<br />//Reports back Value at channel 6 is: 346<br />Serial.println(analogRead(A5));<br />for (int i = 0; i &lt; 16; i++) {<br />Serial.print("Value at channel ");<br />Serial.print(i);<br />Serial.print("is : ");<br />Serial.println(readMux(i));<br />delay(500); //this waits half of a second before switching inputs, play with this as you like.<br />}<br />}</pre>
<p><a href="http://bildr.org/2011/02/cd74hc4067-arduino/"></a></p>